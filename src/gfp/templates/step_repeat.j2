{#
    Defines how we treat the three types of repeat
        - till eos
        - fixed number
        - expression based (tbd)

    The enum for step.repeat unpacks a little weird so we have this strange access
#}
        {%- if step.repeat %}
        self.{{ step.id }} = []

        {%- if step.repeat.value == 'eos' %}
        try:
            while True:
                self.{{ step.id }}.append({% include 'step_cast.j2' %})
        except EOFError:
            _ = 42
        {%- elif step.repeat.value == 'expr' %}
        count = self.{{ step.repeat_expr }}
        for _ in range(count):
            self.{{ step.id }}.append({% include 'step_cast.j2' %})
        {%- elif step.repeat.value == 'until' %}

        {%- else %}
        # {{ step.repeat }} not supported
        {%- endif -%}
        {%- else %}
        self.{{ step.id }} = {% include 'step_cast.j2' %}
        {%- endif -%}
